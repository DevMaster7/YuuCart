<!--
Rewards & Redeem â€” Deep Analysis + HTML/CSS/JS Single File

Contents:
  1) Business & UX analysis (below)
  2) Production-minded single HTML file implementing a polished Rewards & Redeem page
     - Uses provided palette: Primary #023047, Secondary #219EBC, Accent #FB8500, Highlight #F8F9FA, Heading #CCD6F6
     - Responsive layout, progress UI, tiers, check-in, spin-to-win, redeem flow, referral link
     - Integration notes for server-side endpoints and database

DEEP ANALYSIS (SUMMARY)

Objectives
- Drive repeat purchases, increase AOV, acquire users via referral, collect UGC (reviews/photos), and keep points liability manageable.

Points model (recommended)
- Earn: 1 point = Rs.0.5 (i.e., 1 point per Rs.20 spent)
- Sign-up: 100 pts
- Daily check-in: 5-10 pts (streak bonus at 7 days +20 pts)
- Review w/photo: 40 pts (limit 1 per product per order)
- Referral: referred user 150 pts after first paid order; referrer 100 pts

Redemption examples
- 100 pts = Rs.50 off
- 200 pts = Free shipping
- 500 pts = Mystery Box
- 800+ pts = Exclusive product

Tiers
- Bronze: 0-999
- Silver: 1000-2499 (1.1Ã— earn)
- Gold: 2500+ (1.25Ã— earn + perks)

KPIs
- DAU/MAU, redemption rate, points liability, referral conversion, AOV uplift

Fraud prevention
- Server-side validation for all point actions
- Rate-limit spins/check-ins; limit review reward per order
- Atomic DB updates on point deduction

DB design (MongoDB)
- users { _id, name, email, points, tier, referralCode, referredBy }
- points_history { userId, delta, type, meta, createdAt }
- rewards_catalog { id, title, pointsCost, type, stock }
- redemptions { id, userId, rewardId, pointsCost, status, createdAt }

API endpoints
- GET /api/rewards/catalog
- POST /api/rewards/checkin { userId }
- POST /api/rewards/spin { userId }
- POST /api/rewards/redeem { userId, rewardId }
- POST /api/rewards/earn { userId, type, meta }

Rollout
- Soft launch 5-10% users with sign-up + purchase points
- Add referrals & check-ins, then gamification
- A/B tests for sign-up bonus & earn rate

-- End analysis --
-- The HTML below is the page implementation (copy as-is). Replace mock storage & functions with your server endpoints when integrating. -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rewards & Redeem â€” Demo</title>
  <style>
    /* Color system (provided + complementaries) */
    :root{
      --primary: #023047;    /* deep navy */
      --secondary: #219EBC;  /* cyan */
      --accent: #FB8500;     /* orange */
      --highlight: #F8F9FA;  /* background */
      --heading: #CCD6F6;    /* light periwinkle */
      --muted: #556677;
      --card-bg: #ffffff;
      --glass: rgba(255,255,255,0.6);
      --success: #16a34a;
      --danger: #dc2626;
      --shadow: 0 8px 30px rgba(2, 48, 71, 0.08);
    }

    /* Reset & basics */
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:linear-gradient(180deg,var(--highlight),#eaf6fb);color:var(--primary)}
    a{color:inherit}
    .container{max-width:1100px;margin:36px auto;padding:20px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px}

    /* Cards */
    .card{background:var(--card-bg);border-radius:12px;padding:16px;box-shadow:var(--shadow)}

    /* Profile */
    .profile{display:flex;gap:14px;align-items:center}
    .avatar{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,var(--heading),var(--secondary));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:22px}
    h1,h2{margin:0}
    .muted{color:var(--muted);font-size:13px}
    .points-big{font-size:36px;font-weight:700;color:var(--primary);margin-top:8px}

    .progress{height:12px;border-radius:16px;background:#e6eef3;overflow:hidden;margin-top:12px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--secondary),var(--accent));width:10%;transition:width .6s ease}

    .actions{display:flex;gap:10px;margin-top:14px}
    .btn{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--secondary));color:white}
    .btn.ghost{background:transparent;border:1px solid rgba(2,48,71,0.06)}
    .btn.accent{background:var(--accent);color:white}

    .small{font-size:13px;padding:8px 10px}

    /* Rewards grid */
    .catalog{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
    .reward{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfbfd);border:1px solid rgba(2,48,71,0.03)}
    .reward .title{font-weight:700;color:var(--primary)}
    .reward .meta{font-size:13px;color:var(--muted);margin-top:6px}

    /* Transactions */
    .txn{display:flex;gap:12px;align-items:center;padding:8px 0;border-bottom:1px dashed #eef4f8}
    .dot{width:10px;height:10px;border-radius:50%}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,48,71,0.38);display:flex;align-items:center;justify-content:center}
    .modal{background:white;padding:20px;border-radius:10px;max-width:480px;width:92%;box-shadow:var(--shadow)}

    /* Spin */
    .spin{display:flex;align-items:center;justify-content:center;height:120px;border-radius:12px;background:linear-gradient(180deg,#fff,#fffefc);border:1px solid rgba(2,48,71,0.04);font-size:28px}

    /* Responsive */
    @media (max-width:880px){.grid{grid-template-columns:1fr}.avatar{width:56px;height:56px}.container{padding:14px}}
  </style>
</head>
<body>
  <div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
      <div>
        <h1 style="margin:0;color:var(--primary)">Rewards & Redeem</h1>
        <div class="muted">Earn points, unlock perks, and redeem for discounts or exclusive items.</div>
      </div>
      <div style="text-align:right">
        <div class="muted">Your brand</div>
        <div style="font-weight:700;color:var(--secondary)">Sigma Store</div>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT COLUMN -->
      <div>
        <div class="card">
          <div class="profile">
            <div class="avatar" id="avatar">M</div>
            <div>
              <h2 id="userName">Muneeb</h2>
              <div class="muted">Member since 2025 â€¢ Tier: <span id="userTier">Bronze</span></div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div class="points-big" id="pointsVal">320 pts</div>
            <div class="muted">Estimated value: <strong id="pointsValue">Rs.160</strong></div>

            <div style="margin-top:12px">
              <div class="muted" style="font-size:12px;text-transform:uppercase">Progress to next tier</div>
              <div class="progress" aria-hidden="true"><i id="progressBar"></i></div>
              <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:13px;color:var(--muted)"><span id="tierRange">0 pts</span><span id="tierTarget">1000 pts</span></div>
            </div>

            <div class="actions">
              <button class="btn primary" id="checkInBtn">Daily Check-in</button>
              <button class="btn ghost" id="spinBtn">Spin to Win</button>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
              <input id="refInput" aria-label="Referral link" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e7eef3" readonly>
              <button class="btn small accent" id="copyRef">Copy</button>
            </div>

          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div><div style="font-size:12px;color:var(--muted);text-transform:uppercase">Quick Actions</div><div style="font-weight:700">Redeem & Special Offers</div></div>
            <div class="muted">Balance: <strong id="pointsSmall">320</strong> pts</div>
          </div>

          <div id="catalog" class="catalog"></div>

        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div>
        <div class="card" style="margin-bottom:12px">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <div style="font-size:12px;color:var(--muted);text-transform:uppercase">Activity</div>
              <div style="font-weight:700">Recent transactions</div>
            </div>
            <div class="muted">Total: <strong id="pointsTotal">320</strong> pts</div>
          </div>

          <div style="margin-top:12px" id="txList"></div>
        </div>

        <div class="card">
          <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
            <div>
              <div style="font-size:12px;color:var(--muted);text-transform:uppercase">Daily Fun</div>
              <div style="font-weight:700">Spin the wheel â€” once per 24h</div>
            </div>
            <div style="width:220px">
              <div class="spin" id="spinBox">ðŸŽ¯</div>
            </div>
          </div>
          <div style="margin-top:10px;color:var(--muted);font-size:13px">Spin rewards: points (10â€“500), free shipping voucher, small coupon. Server validation required in production.</div>
        </div>

      </div>
    </div>

  </div>

  <div id="modalRoot" style="display:none"></div>

  <script>
    /* === Mock data & simple local persistence for demo === */
    const MOCK_USER = { id: 'user_01', name: 'Muneeb', points: 320, tier: 'Bronze', ref: 'SIGMA123' };
    const CATALOG = [
      { id: 'coupon50', title: 'Rs.50 Off', pts: 100, subtitle: 'Min order Rs.500' },
      { id: 'freeship', title: 'Free Shipping', pts: 200, subtitle: 'Next order' },
      { id: 'mystery', title: 'Mystery Box', pts: 500, subtitle: 'Surprise items' },
      { id: 'exclusive-mug', title: 'Exclusive Mug', pts: 800, subtitle: 'Limited edition' }
    ];
    const TX = [
      { id: 1, date: '2025-09-17', desc: 'Welcome Bonus', pts: +100 },
      { id: 2, date: '2025-09-15', desc: 'Order #1234', pts: +50 },
      { id: 3, date: '2025-09-14', desc: 'Redeemed: Rs.50 Off', pts: -100 }
    ];

    const LS_USER = 'demo_rewards_user_v1'; const LS_TX = 'demo_rewards_tx_v1';
    let user = JSON.parse(localStorage.getItem(LS_USER)) || MOCK_USER; let tx = JSON.parse(localStorage.getItem(LS_TX)) || TX;

    const TIERS = [ { name: 'Bronze', min:0, max:999 }, { name: 'Silver', min:1000, max:2499 }, { name: 'Gold', min:2500, max:999999 } ];

    function save(){ localStorage.setItem(LS_USER, JSON.stringify(user)); localStorage.setItem(LS_TX, JSON.stringify(tx)); }

    function getTier(points){ const t = TIERS.find(x => points>=x.min && points<=x.max); return t? t.name : 'Bronze'; }
    function renderUser(){ document.getElementById('userName').textContent = user.name; document.getElementById('pointsVal').textContent = user.points + ' pts'; document.getElementById('pointsSmall').textContent = user.points; document.getElementById('pointsTotal').textContent = user.points; document.getElementById('pointsValue').textContent = 'Rs.' + Math.round(user.points*0.5); document.getElementById('userTier').textContent = getTier(user.points); document.getElementById('refInput').value = window.location.origin + '/r/' + (user.ref||('REF'+user.id)); updateProgress(); }

    function updateProgress(){ const tier = TIERS.find(x=>getTier(user.points)===x.name); const next = TIERS.find(x=>x.min>tier.min) || {min: tier.max+1}; const progress = Math.min(1, (user.points - tier.min)/Math.max(1,(next.min - tier.min))); document.getElementById('progressBar').style.width = Math.round(progress*100)+'%'; document.getElementById('tierRange').textContent = tier.min + ' pts'; document.getElementById('tierTarget').textContent = next.min + ' pts'; }

    function renderCatalog(){ const out = document.getElementById('catalog'); out.innerHTML = ''; CATALOG.forEach(item=>{ const el = document.createElement('div'); el.className='reward'; el.innerHTML = `<div class='title'>${item.title}</div><div class='meta'>${item.subtitle}</div><div style='display:flex;justify-content:space-between;align-items:center;margin-top:12px'><div style='font-size:12px;color:var(--muted)'>Cost: ${item.pts} pts</div><div><button class='btn small ghost' onclick="viewDetail('${item.id}')">Details</button> <button class='btn small primary' onclick="redeem('${item.id}')">Redeem</button></div></div>`; out.appendChild(el); }); }

    function renderTx(){ const list = document.getElementById('txList'); list.innerHTML=''; tx.slice(0,10).forEach(ti=>{ const row = document.createElement('div'); row.className='txn'; const dot = document.createElement('div'); dot.style.width='8px'; dot.style.height='8px'; dot.style.borderRadius='50%'; dot.style.background = ti.pts>0? 'var(--secondary)': 'var(--danger)'; const info = document.createElement('div'); info.style.flex='1'; info.innerHTML = `<div style='font-weight:600'>${ti.desc}</div><div style='font-size:13px;color:var(--muted)'>${ti.date}</div>`; const amt = document.createElement('div'); amt.style.fontWeight='700'; amt.textContent = (ti.pts>0?'+':'')+ti.pts+' pts'; row.appendChild(dot); row.appendChild(info); row.appendChild(amt); list.appendChild(row); }); }

    renderUser(); renderCatalog(); renderTx();

    /* === Actions === */
    document.getElementById('checkInBtn').addEventListener('click', ()=>{
      const key = 'checkin_' + user.id + '_' + new Date().toISOString().slice(0,10);
      if (localStorage.getItem(key)) return showModal('Already claimed','You already checked in today.');
      const pts = 10; user.points += pts; tx.unshift({id:Date.now(), date:new Date().toISOString().slice(0,10), desc:'Daily check-in', pts}); localStorage.setItem(key,'1'); save(); renderUser(); renderTx(); showModal('Check-in success', `You earned ${pts} pts`);
    });

    window.redeem = function(id){ const item = CATALOG.find(i=>i.id===id); if(!item) return; if(user.points<item.pts) return showModal('Not enough points', `Need ${item.pts - user.points} more pts`); // In production: call server endpoint to create redemption record
      user.points -= item.pts; tx.unshift({id:Date.now(), date:new Date().toISOString().slice(0,10), desc:'Redeemed: '+item.title, pts:-item.pts}); save(); renderUser(); renderTx(); showModal('Redeemed', `You redeemed ${item.title}. Check account for voucher.`); };

    window.viewDetail = function(id){ const item = CATALOG.find(i=>i.id===id); if(!item) return; showModal(item.title, `${item.subtitle} â€” Cost: ${item.pts} pts`); };

    document.getElementById('spinBtn').addEventListener('click', ()=>{
      const key = 'spin_' + user.id; const last = localStorage.getItem(key); if(last && Date.now() - Number(last) < 1000*60*60*24) return showModal('Cooldown','You can spin again in 24 hours.');
      const spinBox = document.getElementById('spinBox'); spinBox.textContent = 'Spinning...'; const outcomes = [{t:'p',v:10},{t:'p',v:25},{t:'p',v:50},{t:'p',v:100},{t:'p',v:250},{t:'p',v:500},{t:'v',v:'FreeShip'},{t:'c',v:'Rs.50 Off'}]; const res = outcomes[Math.floor(Math.random()*outcomes.length)]; setTimeout(()=>{ if(res.t==='p'){ user.points += res.v; tx.unshift({id:Date.now(),date:new Date().toISOString().slice(0,10),desc:'Spin reward',pts:+res.v}); showModal('You won points!', `You earned ${res.v} pts`); } else { tx.unshift({id:Date.now(),date:new Date().toISOString().slice(0,10),desc:'Spin reward: '+res.v,pts:0}); showModal('You won!', `You won ${res.v}`); } localStorage.setItem(key, Date.now()); save(); renderUser(); renderTx(); spinBox.textContent='ðŸŽ¯'; }, 1200);
    });

    document.getElementById('copyRef').addEventListener('click', ()=>{ const ip = document.getElementById('refInput'); ip.select(); document.execCommand('copy'); showModal('Copied','Referral link copied to clipboard'); });

    function showModal(title, content){ const root = document.getElementById('modalRoot'); root.style.display='block'; root.innerHTML = `<div class='modal-backdrop' onclick='closeModal()'><div class='modal' onclick='event.stopPropagation()'><h3 style='margin-top:0'>${title}</h3><div style='color:var(--muted);margin-top:8px'>${content}</div><div style='text-align:right;margin-top:16px'><button class='btn ghost' onclick='closeModal()'>Close</button></div></div></div>`; }
    function closeModal(){ const root=document.getElementById('modalRoot'); root.style.display='none'; root.innerHTML=''; }

    window.closeModal = closeModal;
    window.addEventListener('beforeunload', save);

    /*
      Integration checklist:
      - Replace localStorage mocks with API calls to endpoints listed in analysis.
      - Server-side must validate and timestamp: checkin, spin, redeem, referral claims.
      - For vouchers: server generates unique coupon code and returns it to user account redemptions list.
      - Track points liability in admin dashboard and create scheduled expiry if you want to limit liability (e.g., points expire after 18 months).
    */
  </script>
</body>
</html>
