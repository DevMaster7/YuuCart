<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Styled Multiselect</title>

    <style>
        :root {
            --Primary: #023047;
            --Secondary: #219EBC;
            --Accent: #FB8500;
            --Highlight: #F8F9FA;
            --Text: #545454;
        }

        body {
            font-family: system-ui, "Segoe UI", Roboto, Arial, sans-serif;
            background: #f4f4f4;
            padding: 40px;
        }

        /* MAIN FIELD */
        .multi-field {
            width: 300px;
            position: relative;
        }

        .multi-header {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--Text);
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
            color: #1b1b1b;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.2s ease;
        }

        .multi-header:hover {
            border-color: #333;
        }

        .multi-value.placeholder {
            color: #999;
        }

        .multi-arrow {
            font-size: 13px;
            color: var(--Text);
            pointer-events: none;
        }

        /* Floating Label */
        .multi-field label {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: var(--Text);
            background: var(--Highlight);
            padding: 0 4px;
            pointer-events: none;
            transition: all 0.2s ease;
        }

        .multi-header.active+label,
        .multi-header.filled+label {
            top: -8px;
            font-size: 13px;
            color: var(--Text);
            transform: none;
        }

        /* Dropdown */
        .dropdown-panel {
            width: 100%;
            margin-top: 6px;
            background: white;
            border: 1px solid var(--Text);
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: none;
            overflow: hidden;
            z-index: 99;
            position: absolute;
        }

        .dropdown-panel.show {
            display: block;
        }

        .search-box input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin: 10px;
            font-size: 14px;
        }

        .options-list {
            max-height: 220px;
            overflow-y: auto;
            border-top: 1px solid #eee;
        }

        .option {
            padding: 10px 12px;
            display: flex;
            gap: 10px;
            align-items: center;
            cursor: pointer;
        }

        .option:hover {
            background: #f9f9f9;
        }

        .option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--Secondary);
            cursor: pointer;
        }

        .lbl {
            font-size: 14px;
            color: #222;
        }

        .helper-row {
            padding: 8px 12px;
            font-size: 13px;
            color: #666;
            border-top: 1px solid #f2f2f2;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>

    <div class="multi-field" id="multifield">

        <div class="multi-header" id="multiHeader" tabindex="0">
            <div class="multi-value placeholder" id="displayValue">Select options</div>
            <div class="multi-arrow">â–¼</div>
        </div>

        <label>Fruits</label>

        <div class="dropdown-panel" id="dropdown">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search...">
            </div>

            <div class="options-list" id="optionsList">

                <div class="option">
                    <input type="checkbox" id="selectAll">
                    <div class="lbl"><strong>Select all</strong></div>
                </div>

                <div class="option"><input type="checkbox" data-value="Apple">
                    <div class="lbl">Apple</div>
                </div>
                <div class="option"><input type="checkbox" data-value="Orange">
                    <div class="lbl">Orange</div>
                </div>
                <div class="option"><input type="checkbox" data-value="Banana">
                    <div class="lbl">Banana</div>
                </div>
                <div class="option"><input type="checkbox" data-value="Grapes">
                    <div class="lbl">Grapes</div>
                </div>
                <div class="option"><input type="checkbox" data-value="Mango">
                    <div class="lbl">Mango</div>
                </div>
                <div class="option"><input type="checkbox" data-value="Strawberry">
                    <div class="lbl">Strawberry</div>
                </div>
                <div class="option"><input type="checkbox" data-value="Watermelon">
                    <div class="lbl">Watermelon</div>
                </div>

            </div>

            <div class="helper-row">
                <div id="countInfo">0 selected</div>
                <div>Esc to close</div>
            </div>
        </div>

    </div>

    <script>
        (function () {
            const multiHeader = document.getElementById("multiHeader");
            const dropdown = document.getElementById("dropdown");
            const searchInput = document.getElementById("searchInput");
            const optionsList = document.getElementById("optionsList");
            const displayValue = document.getElementById("displayValue");
            const countInfo = document.getElementById("countInfo");
            const selectAll = document.getElementById("selectAll");

            let selected = new Set();

            function allOptions() {
                return [...optionsList.querySelectorAll('.option input[type="checkbox"]')]
                    .filter(cb => cb !== selectAll);
            }

            function open() {
                dropdown.classList.add("show");
                multiHeader.classList.add("active");
            }

            function close() {
                dropdown.classList.remove("show");
                multiHeader.classList.remove("active");
                searchInput.value = "";
                filter("");
            }

            multiHeader.addEventListener("click", () => {
                dropdown.classList.contains("show") ? close() : open();
            });

            document.addEventListener("click", (e) => {
                if (!document.getElementById("multifield").contains(e.target)) close();
            });

            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") close();
            });

            optionsList.addEventListener("click", (e) => {
                const row = e.target.closest(".option");
                if (!row) return;
                const cb = row.querySelector("input");

                if (cb === selectAll) {
                    const checked = cb.checked;
                    allOptions().forEach(c => c.checked = checked);
                    selected = checked ? new Set(allOptions().map(c => c.dataset.value)) : new Set();
                    render();
                    return;
                }

                cb.checked = !cb.checked;
                cb.checked ? selected.add(cb.dataset.value) : selected.delete(cb.dataset.value);

                selectAll.checked = allOptions().every(c => c.checked);
                render();
            });

            function render() {
                const arr = [...selected];

                if (arr.length === 0) {
                    displayValue.textContent = "Select options";
                    displayValue.classList.add("placeholder");
                    multiHeader.classList.remove("filled");
                } else {
                    displayValue.textContent =
                        arr.slice(0, 3).join(", ") + (arr.length > 3 ? ` +${arr.length - 3}` : "");
                    displayValue.classList.remove("placeholder");
                    multiHeader.classList.add("filled");
                }

                countInfo.textContent = `${arr.length} selected`;
            }

            function filter(term) {
                term = term.toLowerCase();
                optionsList.querySelectorAll(".option").forEach((opt, i) => {
                    if (i === 0) return;
                    const text = opt.innerText.toLowerCase();
                    opt.style.display = text.includes(term) ? "flex" : "none";
                });
            }

            searchInput.addEventListener("input", (e) => filter(e.target.value));
        })();
    </script>
</body>

</html>